<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="it"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>VerGen.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">parent$MyZookeeperRemoveWatchesTest.exec</a> &gt; <a href="index.source.html" class="el_package">org.apache.zookeeper.version.util</a> &gt; <span class="el_source">VerGen.java</span></div><h1>VerGen.java</h1><pre class="source lang-java linenums">/**
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * &quot;License&quot;); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.apache.zookeeper.version.util;

import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

<span class="nc" id="L27">public class VerGen {</span>
    private static final String PACKAGE_NAME = &quot;org.apache.zookeeper.version&quot;;
    private static final String TYPE_NAME = &quot;Info&quot;;

    static void printUsage() {
<span class="nc" id="L32">        System.out.print(&quot;Usage:\tjava  -cp &lt;classpath&gt; org.apache.zookeeper.&quot;</span>
                + &quot;version.util.VerGen maj.min.micro[-qualifier] rev buildDate&quot;);
<span class="nc" id="L34">        System.exit(1);</span>
<span class="nc" id="L35">    }</span>

    public static void generateFile(File outputDir, Version version, String rev, String buildDate)
    {
<span class="nc" id="L39">        String path = PACKAGE_NAME.replaceAll(&quot;\\.&quot;, &quot;/&quot;);</span>
<span class="nc" id="L40">        File pkgdir = new File(outputDir, path);</span>
<span class="nc bnc" id="L41" title="All 2 branches missed.">        if (!pkgdir.exists()) {</span>
            // create the pkg directory
<span class="nc" id="L43">            boolean ret = pkgdir.mkdirs();</span>
<span class="nc bnc" id="L44" title="All 2 branches missed.">            if (!ret) {</span>
<span class="nc" id="L45">                System.out.println(&quot;Cannnot create directory: &quot; + path);</span>
<span class="nc" id="L46">                System.exit(1);</span>
            }
<span class="nc bnc" id="L48" title="All 2 branches missed.">        } else if (!pkgdir.isDirectory()) {</span>
            // not a directory
<span class="nc" id="L50">            System.out.println(path + &quot; is not a directory.&quot;);</span>
<span class="nc" id="L51">            System.exit(1);</span>
        }

<span class="nc" id="L54">        try (FileWriter w = new FileWriter(new File(pkgdir, TYPE_NAME + &quot;.java&quot;))) {</span>
<span class="nc" id="L55">            w.write(&quot;// Do not edit!\n// File generated by org.apache.zookeeper&quot;</span>
                    + &quot;.version.util.VerGen.\n&quot;);
<span class="nc" id="L57">            w.write(&quot;/**\n&quot;);</span>
<span class="nc" id="L58">            w.write(&quot;* Licensed to the Apache Software Foundation (ASF) under one\n&quot;);</span>
<span class="nc" id="L59">            w.write(&quot;* or more contributor license agreements.  See the NOTICE file\n&quot;);</span>
<span class="nc" id="L60">            w.write(&quot;* distributed with this work for additional information\n&quot;);</span>
<span class="nc" id="L61">            w.write(&quot;* regarding copyright ownership.  The ASF licenses this file\n&quot;);</span>
<span class="nc" id="L62">            w.write(&quot;* to you under the Apache License, Version 2.0 (the\n&quot;);</span>
<span class="nc" id="L63">            w.write(&quot;* \&quot;License\&quot;); you may not use this file except in compliance\n&quot;);</span>
<span class="nc" id="L64">            w.write(&quot;* with the License.  You may obtain a copy of the License at\n&quot;);</span>
<span class="nc" id="L65">            w.write(&quot;*\n&quot;);</span>
<span class="nc" id="L66">            w.write(&quot;*     http://www.apache.org/licenses/LICENSE-2.0\n&quot;);</span>
<span class="nc" id="L67">            w.write(&quot;*\n&quot;);</span>
<span class="nc" id="L68">            w.write(&quot;* Unless required by applicable law or agreed to in writing, software\n&quot;);</span>
<span class="nc" id="L69">            w.write(&quot;* distributed under the License is distributed on an \&quot;AS IS\&quot; BASIS,\n&quot;);</span>
<span class="nc" id="L70">            w.write(&quot;* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n&quot;);</span>
<span class="nc" id="L71">            w.write(&quot;* See the License for the specific language governing permissions and\n&quot;);</span>
<span class="nc" id="L72">            w.write(&quot;* limitations under the License.\n&quot;);</span>
<span class="nc" id="L73">            w.write(&quot;*/\n&quot;);</span>
<span class="nc" id="L74">            w.write(&quot;\n&quot;);</span>
<span class="nc" id="L75">            w.write(&quot;package &quot; + PACKAGE_NAME + &quot;;\n\n&quot;);</span>
<span class="nc" id="L76">            w.write(&quot;public interface &quot; + TYPE_NAME + &quot; {\n&quot;);</span>
<span class="nc" id="L77">            w.write(&quot;    int MAJOR=&quot; + version.maj + &quot;;\n&quot;);</span>
<span class="nc" id="L78">            w.write(&quot;    int MINOR=&quot; + version.min + &quot;;\n&quot;);</span>
<span class="nc" id="L79">            w.write(&quot;    int MICRO=&quot; + version.micro + &quot;;\n&quot;);</span>
<span class="nc" id="L80">            w.write(&quot;    String QUALIFIER=&quot;</span>
<span class="nc bnc" id="L81" title="All 2 branches missed.">                    + (version.qualifier == null ? null :</span>
<span class="nc" id="L82">                        &quot;\&quot;&quot; + version.qualifier + &quot;\&quot;&quot;)</span>
                    + &quot;;\n&quot;);
<span class="nc bnc" id="L84" title="All 2 branches missed.">            if (rev.equals(&quot;-1&quot;)) {</span>
<span class="nc" id="L85">                System.out.println(&quot;Unknown REVISION number, using &quot; + rev);</span>
            }
<span class="nc" id="L87">            w.write(&quot;    int REVISION=-1; //@deprecated, please use REVISION_HASH\n&quot;);</span>
<span class="nc" id="L88">            w.write(&quot;    String REVISION_HASH=\&quot;&quot; + rev + &quot;\&quot;;\n&quot;);</span>
<span class="nc" id="L89">            w.write(&quot;    String BUILD_DATE=\&quot;&quot; + buildDate</span>
                    + &quot;\&quot;;\n&quot;);
<span class="nc" id="L91">            w.write(&quot;}\n&quot;);</span>
<span class="nc" id="L92">        } catch (IOException e) {</span>
<span class="nc" id="L93">            System.out.println(&quot;Unable to generate version.Info file: &quot;</span>
<span class="nc" id="L94">                    + e.getMessage());</span>
<span class="nc" id="L95">            System.exit(1);</span>
<span class="nc" id="L96">        }</span>
<span class="nc" id="L97">    }</span>

<span class="nc" id="L99">    public static class Version {</span>
        public int maj;
        public int min;
        public int micro;
        public String qualifier;
    }

    public static Version parseVersionString(String input) {
<span class="nc" id="L107">        Version result = new Version();</span>

<span class="nc" id="L109">        Pattern p = Pattern.compile(&quot;^(\\d+)\\.(\\d+)\\.(\\d+)((\\.\\d+)*)(-(.+))?$&quot;);</span>
<span class="nc" id="L110">        Matcher m = p.matcher(input);</span>

<span class="nc bnc" id="L112" title="All 2 branches missed.">        if (!m.matches()) {</span>
<span class="nc" id="L113">            return null;</span>
        }
<span class="nc" id="L115">        result.maj = Integer.parseInt(m.group(1));</span>
<span class="nc" id="L116">        result.min = Integer.parseInt(m.group(2));</span>
<span class="nc" id="L117">        result.micro = Integer.parseInt(m.group(3));</span>
<span class="nc bnc" id="L118" title="All 2 branches missed.">        if (m.groupCount() == 7) {</span>
<span class="nc" id="L119">            result.qualifier = m.group(7);</span>
        } else {
<span class="nc" id="L121">            result.qualifier = null;</span>
        }
<span class="nc" id="L123">        return result;</span>
    }

    /**
     * Emits a org.apache.zookeeper.version.Info interface file with version and
     * revision information constants set to the values passed in as command
     * line parameters. The file is created in the current directory. &lt;br&gt;
     * Usage: java org.apache.zookeeper.version.util.VerGen maj.min.micro[-qualifier]
     * rev buildDate
     *
     * @param args
     *            &lt;ul&gt;
     *            &lt;li&gt;maj - major version number
     *            &lt;li&gt;min - minor version number
     *            &lt;li&gt;micro - minor minor version number
     *            &lt;li&gt;qualifier - optional qualifier (dash followed by qualifier text)
     *            &lt;li&gt;rev - current Git revision number
     *            &lt;li&gt;buildDate - date the build
     *            &lt;/ul&gt;
     */
    public static void main(String[] args) {
<span class="nc bnc" id="L144" title="All 2 branches missed.">        if (args.length != 3)</span>
<span class="nc" id="L145">            printUsage();</span>
        try {
<span class="nc" id="L147">            Version version = parseVersionString(args[0]);</span>
<span class="nc bnc" id="L148" title="All 2 branches missed.">            if (version == null) {</span>
<span class="nc" id="L149">                System.err.println(</span>
                        &quot;Invalid version number format, must be \&quot;x.y.z(-.*)?\&quot;&quot;);
<span class="nc" id="L151">                System.exit(1);</span>
            }
<span class="nc" id="L153">            String rev = args[1];</span>
<span class="nc bnc" id="L154" title="All 4 branches missed.">            if (rev == null || rev.trim().isEmpty()) {</span>
<span class="nc" id="L155">                rev = &quot;-1&quot;;</span>
            } else {
<span class="nc" id="L157">                rev = rev.trim();</span>
            }
<span class="nc" id="L159">            generateFile(new File(&quot;.&quot;), version, rev, args[2]);</span>
<span class="nc" id="L160">        } catch (NumberFormatException e) {</span>
<span class="nc" id="L161">            System.err.println(</span>
                    &quot;All version-related parameters must be valid integers!&quot;);
<span class="nc" id="L163">            throw e;</span>
<span class="nc" id="L164">        }</span>
<span class="nc" id="L165">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>